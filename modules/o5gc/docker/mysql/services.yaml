services:
  mysql:
    image: o5gc/mysql
    container_name: "mysql"
    env_file: [ "${ENV_FILE}" ]
    volumes:
      - ./my.cnf:/etc/mysql/conf.d/my.cnf:ro
    networks:
      corenet:
        ipv4_address: ${MYSQL_IP_ADDR}
    labels:
      o5gc.stack: ${O5GC_STACK}
    healthcheck:
      test: bash -c "exec 6<> /dev/tcp/localhost/3306"

  phpmyadmin:
    image: phpmyadmin/phpmyadmin:5.1
    container_name: phpmyadmin
    environment:
      - PMA_HOST=${MYSQL_IP_ADDR}
      - PMA_USER=root
      - PMA_PASSWORD=${MYSQL_ROOT_PASSWORD}
    networks:
      - corenet
      - o5gc
    ports:
      - ${PHPMYADMIN_HOST_PORT}:80
    labels:
      o5gc.stack: ${O5GC_STACK}
      o5gc.webui.hide: true
      o5gc.link.title: "phpMyAdmin"
      o5gc.link.url: "http://{{host}}:${PHPMYADMIN_HOST_PORT}/"
    profiles: [ "phpmyadmin" ]
